{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","find","events","on","render","noDataPoints","html","getLegendHeight","panel","legend","isShowing","position","getLegendWidth","addChart","width","height","options","type","data","datasets","_","map","rows","row","measureColumnIndex","backgroundColor","seriesColors","hoverBackgroundColor","labels","seriesColumnIndex","responsive","gap","sort","display","fullWidth","isFullWidth","reverse","isReverse","canvas","jQuery","appendTo","style","marginTop","ctx","getContext","chart","FunnelChart","incrementRenderCounter","length","renderingCompleted"],"mappings":"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","sourcesContent":["import _ from 'lodash';\r\n//import * as ChartJS from './external/chart.bundle';\r\nimport * as FunnelChart from './external/chart.funnel.bundled.min';\r\n\r\nexport default function link(scope, elem, attrs, ctrl) {\r\n  elem = elem.find('.funnelchart-panel__chart');\r\n\r\n  ctrl.events.on('render', function () {\r\n      render(true);\r\n  });\r\n\r\n  function noDataPoints() {\r\n    var html = '<div class=\"datapoints-warning\"><span class=\"small\">No data points</span></div>';\r\n    elem.html(html);\r\n  }\r\n\r\n  function getLegendHeight () {\r\n\r\n    if (ctrl.panel.legend.isShowing && (ctrl.panel.legend.position == 'top' || ctrl.panel.legend.position == 'bottom')) {\r\n      return 30;\r\n    }\r\n\r\n    return 40;\r\n  }\r\n\r\n  function getLegendWidth () {\r\n\r\n    if (ctrl.panel.legend.isShowing && (ctrl.panel.legend.position == 'left' || ctrl.panel.legend.position == 'right')) {\r\n      return 40;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  function addChart() {\r\n    var width = elem.width() - getLegendWidth();\r\n    var height = ctrl.height - getLegendHeight();\r\n\r\n    var options = {\r\n      type: 'funnel',\r\n      data: {\r\n          datasets: [{\r\n              data: _.map(ctrl.data.rows, (row) => { return row[ctrl.panel.measureColumnIndex] }),\r\n              backgroundColor: ctrl.panel.seriesColors,\r\n              hoverBackgroundColor: ctrl.panel.seriesColors\r\n          }],\r\n          labels: _.map(ctrl.data.rows, (row) => { return row[ctrl.panel.seriesColumnIndex] })\r\n      },\r\n      options: {\r\n        responsive: true,\r\n        //keep: ctrl.panel.keep,\r\n        gap: ctrl.panel.gap,\r\n        sort: ctrl.panel.sort,\r\n        legend: {\r\n          display: ctrl.panel.legend.isShowing,\r\n          position: ctrl.panel.legend.position,\r\n          fullWidth: ctrl.panel.legend.isFullWidth,\r\n          reverse: ctrl.panel.legend.isReverse\r\n        }\r\n      }\r\n    }\r\n\r\n    elem.html('');\r\n    var canvas = jQuery('<canvas>').appendTo(elem);\r\n    canvas[0].style.marginTop = '10px';\r\n    var ctx = canvas[0].getContext('2d');\r\n    ctx.canvas.height = height;\r\n    ctx.canvas.width = width;\r\n\t\tvar chart = new FunnelChart(ctx, options);\r\n\r\n  }\r\n\r\n  function render(incrementRenderCounter) {\r\n    if (!ctrl.data) { return; }\r\n\r\n    if (0 == ctrl.data.length) {\r\n      noDataPoints();\r\n    } else {\r\n      addChart();\r\n    }\r\n\r\n    if (incrementRenderCounter) {\r\n      ctrl.renderingCompleted();\r\n    }\r\n  }\r\n}\r\n"],"file":"rendering.js"}