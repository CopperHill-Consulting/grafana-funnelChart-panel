{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","find","events","on","render","noDataPoints","html","getLegendWidth","panel","legend","isShowing","position","addChart","width","height","options","type","data","datasets","_","map","rows","row","measureColumnIndex","backgroundColor","seriesColors","hoverBackgroundColor","labels","seriesColumnIndex","responsive","gap","sort","display","fullWidth","isFullWidth","reverse","isReverse","canvas","jQuery","appendTo","ctx","getContext","chart","FunnelChart","incrementRenderCounter","length","renderingCompleted"],"mappings":"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","sourcesContent":["import _ from 'lodash';\r\n//import * as ChartJS from './external/chart.bundle';\r\nimport * as FunnelChart from './external/chart.funnel.bundled.min';\r\n\r\nexport default function link(scope, elem, attrs, ctrl) {\r\n  elem = elem.find('.funnelchart-panel__chart');\r\n\r\n  ctrl.events.on('render', function () {\r\n      render(true);\r\n  });\r\n\r\n  function noDataPoints() {\r\n    var html = '<div class=\"datapoints-warning\"><span class=\"small\">No data points</span></div>';\r\n    elem.html(html);\r\n  }\r\n\r\n  function getLegendWidth () {\r\n\r\n    if (ctrl.panel.legend.isShowing && (ctrl.panel.legend.position == 'left' || ctrl.panel.legend.position == 'right')) {\r\n      return 40;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  function addChart() {\r\n    var width = elem.width() - getLegendWidth();\r\n    var height = ctrl.height - 20;\r\n\r\n    var options = {\r\n      type: 'funnel',\r\n      data: {\r\n          datasets: [{\r\n              data: _.map(ctrl.data.rows, (row) => { return row[ctrl.panel.measureColumnIndex] }),\r\n              backgroundColor: ctrl.panel.seriesColors,\r\n              hoverBackgroundColor: ctrl.panel.seriesColors\r\n          }],\r\n          labels: _.map(ctrl.data.rows, (row) => { return row[ctrl.panel.seriesColumnIndex] })\r\n      },\r\n      options: {\r\n        responsive: true,\r\n        //keep: ctrl.panel.keep,\r\n        gap: ctrl.panel.gap,\r\n        sort: ctrl.panel.sort,\r\n        legend: {\r\n          display: ctrl.panel.legend.isShowing,\r\n          position: ctrl.panel.legend.position,\r\n          fullWidth: ctrl.panel.legend.isFullWidth,\r\n          reverse: ctrl.panel.legend.isReverse\r\n        }\r\n      }\r\n    }\r\n\r\n    elem.html('');\r\n    var canvas = jQuery('<canvas>').appendTo(elem),\r\n        ctx = canvas[0].getContext('2d');\r\n    ctx.canvas.height = height;\r\n    ctx.canvas.width = width;\r\n\t\tvar chart = new FunnelChart(ctx, options);\r\n\r\n  }\r\n\r\n  function render(incrementRenderCounter) {\r\n    if (!ctrl.data) { return; }\r\n\r\n    if (0 == ctrl.data.length) {\r\n      noDataPoints();\r\n    } else {\r\n      addChart();\r\n    }\r\n\r\n    if (incrementRenderCounter) {\r\n      ctrl.renderingCompleted();\r\n    }\r\n  }\r\n}\r\n"],"file":"rendering.js"}